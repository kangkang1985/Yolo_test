name: 'YOLO Detection Alert with Video'

on:
  workflow_dispatch:  # æ·»åŠ è¿™ä¸€è¡Œï¼Œå…è®¸é€šè¿‡APIæ‰‹åŠ¨è§¦å‘
    inputs:
      object:
        description: 'Detected object'
        required: true
        type: string
        default: 'person'
      confidence:
        description: 'Confidence level'
        required: true
        type: string
        default: '>= 0.5'
      time:
        description: 'Detected time'
        required: true
        type: string
      email_header:
        description: 'Email header'
        required: true
        type: string
      recipient:
        description: 'Email address'
        required: true
        type: string
      download_url:  # æ·»åŠ è§†é¢‘ä¸‹è½½URLè¾“å…¥
        description: 'Video download URL'
        required: false
        type: string
        default: 'No video available'

jobs:
  alert:
    name: Send Email Alert
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Send Email via SMTP
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.sina.com
          server_port: 465
          secure: true
          username: ${{ secrets.SINA_MAIL }}
          password: ${{ secrets.SINA_AUTH_CODE }}
          subject: 'ğŸš¨ å®‰å…¨è­¦æŠ¥: ${{ inputs.object }}æ£€æµ‹é€šçŸ¥ - ${{ inputs.email_header }}'
          content_type: text/html
          body: |
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="utf-8">
                <style>
                    body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
                    .header { color: #2c3e50; font-size: 18px; font-weight: bold; }
                    .details { background: #f8f9fa; padding: 15px; border-left: 4px solid #3498db; margin: 10px 0; }
                    .video-link { color: #2980b9; text-decoration: none; }
                    .footer { font-size: 12px; color: #7f8c8d; margin-top: 20px; }
                </style>
            </head>
            <body>
                <p class="header">å°Šæ•¬çš„${{ inputs.email_header }}å®¢æˆ·ï¼Œ</p>
          
                <p>æˆ‘ä»¬çš„å®‰å…¨ç›‘æ§ç³»ç»Ÿåœ¨æ‚¨åŒºåŸŸæ£€æµ‹åˆ°æ´»åŠ¨ã€‚</p>
          
                <div class="details">
                    <p><strong>æ£€æµ‹è¯¦æƒ…ï¼š</strong></p>
                    <ul>
                        <li><strong>ç›®æ ‡ç±»å‹ï¼š</strong>${{ inputs.object }}</li>
                        <li><strong>ç½®ä¿¡åº¦ï¼š</strong>${{ inputs.confidence }}</li>
                        <li><strong>æ£€æµ‹æ—¶é—´ï¼š</strong>${{ inputs.time }}</li>
                    </ul>
                </div>

                ${{ inputs.download_url != 'No video available' && '<p><strong>ç›¸å…³è§†é¢‘è¯æ®ï¼š</strong></p>' || '' }}
                ${{ inputs.download_url != 'No video available' && '<p><a href="' + inputs.download_url + '" class="video-link">ğŸ“¹ æŸ¥çœ‹ç›‘æ§è§†é¢‘</a></p>' || '' }}
                ${{ inputs.download_url != 'No video available' && '<p><small>è§†é¢‘æ‰˜ç®¡åœ¨GitHubå®˜æ–¹å¹³å°ï¼Œå®‰å…¨å¯é ã€‚å¦‚æœé“¾æ¥æ— æ³•ç‚¹å‡»ï¼Œè¯·å¤åˆ¶ä»¥ä¸‹åœ°å€åˆ°æµè§ˆå™¨ï¼š<br>' + inputs.download_url + '</small></p>' || '' }}

                <div class="footer">
                    <p>æ­¤ä¸ºè‡ªåŠ¨å‘é€çš„å®‰å…¨é€šçŸ¥ï¼Œè¯·å‹¿ç›´æ¥å›å¤ã€‚</p>
                    <p>å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»å®‰å…¨å›¢é˜Ÿã€‚</p>
                </div>
            </body>
            </html>
          to: ${{ inputs.recipient }}
          from: æ™ºèƒ½å®‰é˜²é€šçŸ¥ <${{ secrets.SINA_MAIL }}>
