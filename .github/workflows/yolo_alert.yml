name: 'YOLO Detection Alert'
on:
  workflow_dispatch:
    inputs:
      object:
        description: 'æ£€æµ‹åˆ°å¯¹è±¡'
        required: true
        type: string
      confidence:
        description: 'ç½®ä¿¡åº¦'
        required: true
        type: string
      time: 
        description: 'æ£€æµ‹æ—¶é—´'
        required: true
        type: string
      email_header:
        description: 'é‚®ä»¶ç§°å‘¼'
        required: true
        type: string
      recipient:
        description: "å®¢æˆ·é‚®ç®±"
        required: true
        type: string
      download_url:
        description:"è§†é¢‘æŸ¥çœ‹é“¾æ¥"
        required:false
        type:string
        default:"No video available"
    #path: /yolo_alert
    #secret: ${{ secrets.WEBHOOK_SECRET }}
jobs:
  alert:
    name: Send Email
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Send Email via Sina Mail
        uses: dawidd6/action-send-mail@v3
        with:
          # ä½¿ç”¨æ–°æµªé‚®ç®±çš„SMTPæœåŠ¡å™¨
          server_address: smtp.sina.com
          server_port: 465
          secure: true
          # ä½¿ç”¨Secretsä¸­çš„æ–°æµªé‚®ç®±å’Œæˆæƒç 
          username: ${{ secrets.SINA_MAIL }}
          password: ${{ secrets.SINA_AUTH_CODE }}
          subject: 'ğŸš¨ å‘ç°ç›®æ ‡: ${{ github.event.trigger.payload.object }}'
          body: |
            ${{inputs.email_header}}æ‚¨å¥½ï¼Œæ‚¨çš„ç›‘æ§ç³»ç»Ÿå‘ç°äº†ç›®æ ‡ï¼

            - **æ£€æµ‹åˆ°å¯¹è±¡:** ${{ inputs.object }}
            - **ç½®ä¿¡åº¦:** ${{ inputs.confidence }}
            - **æ£€æµ‹æ—¶é—´:** ${{ inputs.time }}
            
            ${{ inputs.video_url != 'No video available' && '**è¯·æŸ¥çœ‹ç›¸å…³è§†é¢‘:**' || '' }}
            ${{ inputs.video_url != 'No video available' && inputs.video_url || '' }}
            ${{ inputs.video_url != 'No video available' && 'è¯·æ³¨æ„ï¼šè§†é¢‘é“¾æ¥å°†åœ¨24å°æ—¶åå¤±æ•ˆã€‚' || '' }}

            å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·åŠæ—¶è”ç³»å®‰å…¨å›¢é˜Ÿã€‚

            ç¥å¥½,
            æ— äººæœºå®‰å…¨ç›‘æ§ç³»ç»Ÿ
          to: ${{inputs.recipient}}  # ã€é‡è¦ã€‘æ”¹æˆä½ çš„ä¸ªäººæ”¶ä»¶é‚®ç®±ï¼Œæ¯”å¦‚ 12345@gmail.com
          from: YOLOç›‘æ§åŠ©æ‰‹ <${{ secrets.SINA_MAIL }}> # å‘ä»¶äººæ˜¾ç¤º
