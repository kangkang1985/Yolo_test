name: 'YOLO Detection Alert with Video'

on:
  workflow_dispatch:  # æ·»åŠ è¿™ä¸€è¡Œï¼Œå…è®¸é€šè¿‡APIæ‰‹åŠ¨è§¦å‘
    inputs:
      object:
        description: 'æ£€æµ‹åˆ°çš„å¯¹è±¡'
        required: true
        type: string
      confidence:
        description: 'ç½®ä¿¡åº¦'
        required: true
        type: string
      time:
        description: 'æ£€æµ‹æ—¶é—´'
        required: true
        type: string
      email_header:
        description: 'é‚®ä»¶ç§°å‘¼'
        required: true
        type: string
      recipient:
        description: 'æ”¶ä»¶äººé‚®ç®±'
        required: true
        type: string
      download_url:  # æ·»åŠ è§†é¢‘ä¸‹è½½URLè¾“å…¥
        description: 'è§†é¢‘ä¸‹è½½é“¾æ¥'
        required: false
        type: string
        default: 'æ— å¯ç”¨è§†é¢‘'

jobs:
  alert:
    name: Send Email Alert
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Send Email via SMTP
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.sina.com.cn
          server_port: 465
          secure: true
          username: ${{ secrets.SINA_MAIL }}
          password: ${{ secrets.SINA_AUTH_CODE }}
          subject: 'ğŸš¨ å®‰å…¨è­¦æŠ¥: ${{ inputs.object }}æ£€æµ‹é€šçŸ¥ - ${{ inputs.email_header }}'
          body: |
            å°Šæ•¬çš„${{ inputs.email_header }},

            æˆ‘ä»¬çš„æ— äººæœºç›‘æ§ç³»ç»Ÿåœ¨æ‚¨æ‰€åœ¨çš„åŒºåŸŸæ£€æµ‹åˆ°å¯ç–‘ç›®æ ‡ã€‚

            - **ç›®æ ‡ç±»å‹:** ${{ inputs.object }}
            - **ç½®ä¿¡åº¦:** ${{ inputs.confidence }}
            - **æ£€æµ‹æ—¶é—´:** ${{ inputs.time }}

            ${{ inputs.download_url != 'æ— å¯ç”¨è§†é¢‘' && '**è¯·æŸ¥çœ‹ç›¸å…³è§†é¢‘ footage:**' || '' }}
            ${{ inputs.download_url != 'æ— å¯ç”¨è§†é¢‘' && inputs.download_url || '' }}

            ${{ inputs.download_url != 'æ— å¯ç”¨è§†é¢‘' && 'è¯·æ³¨æ„ï¼šè§†é¢‘é“¾æ¥å°†åœ¨24å°æ—¶åå¤±æ•ˆã€‚' || '' }}

            å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·åŠæ—¶è”ç³»å®‰å…¨å›¢é˜Ÿã€‚

            ç¥å¥½,
            æ— äººæœºå®‰å…¨ç›‘æ§ç³»ç»Ÿ
          to: ${{ inputs.recipient }}
          from: æ— äººæœºå®‰å…¨ç›‘æ§ç³»ç»Ÿ <${{ secrets.SINA_MAIL }}>
