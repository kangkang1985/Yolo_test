name: 'YOLO Detection Alert with Video'

on:
  workflow_dispatch:  # æ·»åŠ è¿™ä¸€è¡Œï¼Œå…è®¸é€šè¿‡APIæ‰‹åŠ¨è§¦å‘
    inputs:
      object:
        description: 'Person'
        required: true
        type: string
      confidence:
        description: '>=0.5'
        required: true
        type: string
      time:
        description: 'Time'
        required: true
        type: string
      email_header:
        description: 'Email header'
        required: true
        type: string
      recipient:
        description: 'Email address'
        required: true
        type: string
      download_url:  # æ·»åŠ è§†é¢‘ä¸‹è½½URLè¾“å…¥
        description: 'Video download URL'
        required: false
        type: string
        default: 'No video available'

jobs:
  alert:
    name: Send Email Alert
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Send Email via SMTP
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.sina.com
          server_port: 465
          secure: true
          username: ${{ secrets.SINA_MAIL }}
          password: ${{ secrets.SINA_AUTH_CODE }}
          subject: 'ğŸš¨ å®‰å…¨è­¦æŠ¥: ${{ inputs.object }}æ£€æµ‹é€šçŸ¥ - ${{ inputs.email_header }}'
          body: |
            ${{ inputs.email_header }},

            The drone has identified some specious objects in your house:

            - **Object:** ${{ inputs.object }}
            - **Confidence Level:** ${{ inputs.confidence }}
            - **Time:** ${{ inputs.time }}

            ${{ inputs.download_url != 'No video available' && '**Please check the video footage:**' || '' }}
            ${{ inputs.download_url != 'No video available' && inputs.download_url || '' }}
            ${{ inputs.download_url != 'No video available' && 'Note: the download URL is from Github, which is safe and will expire in 24 hours' || '' }}

            æ­¤ä¸ºè‡ªåŠ¨å‘é€çš„å®‰å…¨é€šçŸ¥ï¼Œè¯·å‹¿ç›´æ¥å›å¤ã€‚
            å¦‚æœ‰ä»»ä½•ç–‘é—®ï¼Œè¯·åŠæ—¶è”ç³»å®‰å…¨å›¢é˜Ÿã€‚

            ç¥å¥½,
            æ— äººæœºå®‰å…¨ç›‘æ§ç³»ç»Ÿ
          to: ${{ inputs.recipient }}
          from: æ— äººæœºå®‰å…¨ç›‘æ§ç³»ç»Ÿ <${{ secrets.SINA_MAIL }}>
