name: 'YOLO Detection Alert with Video'

on:
  workflow_dispatch:  # Activate the workflow through the API
    inputs:
      object:
        description: 'Detected Object'
        required: true
        type: string
      confidence:
        description: 'Confidence Level'
        required: true
        type: string
      time:
        description: 'Detected Time'
        required: true
        type: string
      email_header:
        description: 'Email Header'
        required: true
        type: string
      recipient:
        description: 'Email Address'
        required: true
        type: string
      download_url:  # Video download URL
        description: 'Video Download URL'
        required: false
        type: string
        default: 'No Video Available'

jobs:
  alert:
    name: Send Email Alert
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      
      - name: Send Email via SMTP
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.sina.com
          server_port: 465
          secure: true
          username: ${{ secrets.SINA_MAIL }}
          password: ${{ secrets.SINA_AUTH_CODE }}
          subject: 'ðŸš¨ Security Alert: ${{ inputs.object }}identification notification - ${{ inputs.email_header }}'
          body: |
            Dear ${{ inputs.email_header }},

            We have detected a person in your yard

            - **Object Detected:** ${{ inputs.object }}
            - **Confidence Level:** ${{ inputs.confidence }}
            - **Detected Time:** ${{ inputs.time }}

            ${{ inputs.download_url != 'No video available' && '**Please check the video footage:**' || '' }}
            ${{ inputs.download_url != 'No video available' && inputs.download_url || '' }}

            ${{ inputs.download_url != 'No video available' && 'The video will expire in 24 hours' || '' }}

            If you have any questions, please feel free to reach out to us.

            Sincerely,
            Drone security system
          to: ${{ inputs.recipient }}
          from: Drone security system <${{ secrets.SINA_MAIL }}> 
