name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]  # 监听对 main 分支的 push 操作来触发工作流
  workflow_dispatch:     # 允许在 Actions 标签页中手动触发工作流

permissions:
  contents: read
  pages: write    # 提供对 GitHub Pages 的写入权限
  id-token: write # 用于使用 OIDC 进行身份验证

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # 使用 checkout Action 的 v4 版本

      - name: Setup Pages
        uses: actions/configure-pages@v3 # 配置 Pages 构建环境

      # 对于纯静态站点（无构建过程），可注释或删除以下构建步骤
      # - name: Setup Node.js
      #   uses: actions/setup-node@v3
      #   with:
      #     node-version: '18'
      #     cache: 'npm'
      # - name: Build static site
      #   run: |
      #     npm install
      #     npm run build # 请将此命令替换为您实际的构建命令

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3 # 此 Action 专为上传 Pages 产物设计
        with:
          path: . # 上传当前仓库的根目录。如果使用构建步骤，请改为指向输出目录（如 'dist', 'build', 'public'）

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build # 确保 deploy 任务在 build 任务完成后进行
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v3 # 使用官方部署 Pages 的 Action (v3 版本)
